name: "Gitea Mirror"
description: "Mirror GitHub repositories to Gitea organizations automatically"
author: "dangjinghao"

branding:
  icon: "git-branch"
  color: "green"

inputs:
  mirror-github-owner:
    description: "GitHub owner (username or organization)"
    required: true
  mirror-github-token:
    description: "GitHub personal access token with repo read access"
    required: true
  mirror-gitea-url:
    description: "URL to your Gitea instance (e.g. https://git.example.com)"
    required: true
  mirror-gitea-org:
    description: "Gitea organization where mirrors will be created"
    required: true
  mirror-gitea-token:
    description: "Gitea API token with write permissions"
    required: true
  mirror-clone-wiki:
    description: "Whether to clone wiki (true/false)"
    required: false
    default: "false"
  mirror-filter-mode:
    description: 'Filter mode: "include" or "exclude"'
    required: false
    default: "exclude"
  mirror-filter-repo-list:
    description: "comma-separated list of repos to include/exclude based on filter mode"
    required: false
    default: ""
  mirror-interval:
    description: "Mirror sync interval (e.g. 8h, 60m)"
    required: false
    default: "8h"
  mirror-debug:
    description: "Enable debug mode (true/false)"
    required: false
    default: "false"
  mirror-dry-run:
    description: "Enable dry-run mode without making changes (true/false)"
    required: false
    default: "false"

runs:
  using: "composite"
  steps:
    - name: Run mirror script
      shell: bash
      env:
        GITHUB_OWNER: ${{ inputs.mirror-github-owner }}
        GITHUB_TOKEN: ${{ inputs.mirror-github-token }}
        GITEA_ORG: ${{ inputs.mirror-gitea-org }}
        GITEA_URL: ${{ inputs.mirror-gitea-url }}
        GITEA_TOKEN: ${{ inputs.mirror-gitea-token }}
        CLONE_WIKI: ${{ inputs.mirror-clone-wiki }}
        FILTER_MODE: ${{ inputs.mirror-filter-mode }}
        FILTER_REPO_LIST: ${{ inputs.mirror-filter-repo-list }}
        MIRROR_INTERVAL: ${{ inputs.mirror-interval }}
        DRY_RUN: ${{ inputs.mirror-dry-run }}
        DEBUG: ${{ inputs.mirror-debug }}
      run: |
        python3 ${{ github.action_path }}/gitea-mirror-action.py
